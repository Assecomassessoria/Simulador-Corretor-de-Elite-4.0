<!DOCTYPE html>

<html lang="pt-br">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Simulador Corretor de Elite</title>

    <link rel="icon" type="image/png" href="https://i.ibb.co/LzNfXhS/logo-full-social.png">

    <link rel="apple-touch-icon" href="https://i.ibb.co/LzNfXhS/logo-full-social.png">

    <link rel="manifest" href="manifest.json">

    <meta name="apple-mobile-web-app-capable" content="yes">

    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <meta name="apple-mobile-web-app-title" content="Simulador Elite">

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>

        :root {

            --azul-escuro: #001F3F;

            --ouro-fosco: #C5A059;

            --branco: #FFFFFF;

            --preto: #000000;

            --cinza-claro: #F4F4F4;

            --ouro-dourado: #FFD700;

        }



        body {

            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;

            background-color: var(--cinza-claro);

            color: var(--preto);

            margin: 0;

            padding: 10px;

            line-height: 1.6;

        }



        .container {

            max-width: 800px;

            margin: 0 auto;

            background: var(--branco);

            border: 2px solid var(--azul-escuro);

            border-radius: 12px;

            overflow: hidden;

            box-shadow: 0 10px 25px rgba(0,0,0,0.2);

            position: relative;

        }



        /* LOGO STYLES */

        .logo-container {

            padding: 20px;

            text-align: center;

            transition: all 0.5s ease;

        }



        /* VERSÃO DEMO (PADRÃO) */

        .logo-demo {

            background-color: var(--branco);

            color: var(--azul-escuro);

            border-bottom: 4px solid var(--ouro-dourado);

        }

        .logo-demo h1 {

            color: var(--azul-escuro);

            font-size: 1.8rem;

            margin: 0;

            text-transform: uppercase;

        }

        .logo-demo h1 span {

            color: var(--ouro-dourado);

        }

        .logo-demo p {

            color: var(--azul-escuro);

            font-weight: bold;

            margin: 5px 0 0 0;

            letter-spacing: 2px;

        }

/* JSON */

{
  "short_name": "Simulador Elite",
  "name": "Simulador Corretor de Elite 4.0",
  "icons": [
    {
      "src": "icone-192.png",
      "type": "image/png",
      "sizes": "192x192"
    },
    {
      "src": "icone-512.png",
      "type": "image/png",
      "sizes": "512x512"
    }
  ],
  "start_url": ".",
  "display": "standalone",
  "theme_color": "#000000",
  "background_color": "#ffffff"
}



        /* VERSÃO FULL (APÓS SENHA MASTER) */

        .logo-full {

            background-color: var(--azul-escuro) !important;

            color: var(--ouro-fosco) !important;

            border-bottom: 4px solid var(--ouro-fosco) !important;

        }

        .logo-full h1 {

            color: var(--ouro-fosco) !important;

            font-size: 1.8rem;

            margin: 0;

            text-transform: uppercase;

        }

        .logo-full p {

            color: var(--ouro-fosco) !important;

            font-weight: bold;

            margin: 5px 0 0 0;

            letter-spacing: 2px;

        }



        h2 {

            font-size: 1.2rem;

            color: var(--azul-escuro);

            border-bottom: 2px solid var(--ouro-fosco);

            padding-bottom: 5px;

            margin-bottom: 15px;

            text-transform: uppercase;

        }



        .box {

            padding: 20px;

            border-bottom: 1px solid #ddd;

        }



        .box:last-of-type {

            border-bottom: none;

        }



        .grid {

            display: grid;

            grid-template-columns: 1fr 1fr;

            gap: 15px;

        }



        label {

            display: block;

            margin-top: 10px;

            font-weight: bold;

            color: var(--azul-escuro);

            font-size: 0.9rem;

        }



        input, select {

            width: 100%;

            padding: 10px;

            margin-top: 5px;

            border: 1px solid #ccc;

            border-radius: 4px;

            box-sizing: border-box;

            font-size: 1rem;

        }



        input:focus {

            outline: none;

            border-color: var(--ouro-fosco);

            box-shadow: 0 0 5px rgba(197, 160, 89, 0.5);

        }



        .result {

            background: #f9f9f9;

            padding: 10px;

            margin-top: 5px;

            font-weight: bold;

            border-left: 4px solid var(--ouro-fosco);

            color: var(--azul-escuro);

            font-size: 1.1rem;

            min-height: 1.2em;

        }



        .actions {

            display: grid;

            grid-template-columns: 1fr 1fr;

            gap: 10px;

            padding: 20px;

            background: var(--azul-escuro);

        }



        button {

            padding: 12px;

            border: none;

            border-radius: 6px;

            cursor: pointer;

            font-weight: bold;

            text-transform: uppercase;

            transition: all 0.3s;

            font-size: 0.8rem;

        }



        .btn-pdf { background: var(--ouro-fosco); color: var(--azul-escuro); }

        .btn-print { background: var(--branco); color: var(--azul-escuro); }

        .btn-wa { background: #25D366; color: white; }

        .btn-email { background: #EA4335; color: white; }

        .btn-doc { background: #34B7F1; color: white; grid-column: span 2; }

        .btn-graficos { background: #9C27B0; color: white; grid-column: span 2; }



        button:hover {

            opacity: 0.9;

            transform: translateY(-2px);

        }



        footer {

            padding: 20px;

            background: #eee;

            font-size: 0.8rem;

            text-align: justify;

            color: #555;

            border-top: 1px solid #ccc;

        }



        #lock-screen {

            position: fixed;

            top: 0; left: 0; width: 100%; height: 100%;

            background: var(--azul-escuro);

            color: var(--ouro-fosco);

            display: flex;

            flex-direction: column;

            align-items: center;

            justify-content: center;

            z-index: 1000;

            text-align: center;

        }



        #lock-screen input {

            width: 250px;

            margin: 10px;

            text-align: center;

        }



        #lock-screen button {

            background: var(--ouro-fosco);

            color: var(--azul-escuro);

            width: 250px;

        }



        .hidden { display: none !important; }



        .graficos-container {

            padding: 20px;

            background: #f9f9f9;

            border-top: 2px solid var(--ouro-fosco);

            margin-top: 20px;

        }



        .graficos-container h2 {

            color: var(--azul-escuro);

            border-bottom: 2px solid var(--ouro-fosco);

            padding-bottom: 10px;

            margin-bottom: 20px;

        }



        .grafico-item {

            background: white;

            padding: 15px;

            margin-bottom: 20px;

            border-radius: 8px;

            border: 1px solid #ddd;

        }



        .grafico-item h3 {

            color: var(--azul-escuro);

            margin-top: 0;

            font-size: 1rem;

        }



        .grafico-item p {

            color: #666;

            font-size: 0.85rem;

            margin-bottom: 15px;

        }



        .grafico-canvas {

            position: relative;

            height: 300px;

            margin-bottom: 15px;

        }



        /* ESTILOS ADM-MASTER */

        #btn-adm-master {

            position: fixed;

            bottom: 10px;

            right: 10px;

            background-color: var(--azul-escuro);

            color: var(--ouro-fosco);

            border: 1px solid var(--ouro-fosco);

            padding: 8px 12px;

            border-radius: 4px;

            font-size: 0.7rem;

            cursor: pointer;

            z-index: 9999;

            font-weight: bold;

            text-transform: uppercase;

            box-shadow: 0 2px 5px rgba(0,0,0,0.3);

        }



        #modal-adm-master {

            position: fixed;

            top: 0; left: 0; width: 100%; height: 100%;

            background: rgba(0, 31, 63, 0.9);

            display: flex;

            align-items: center;

            justify-content: center;

            z-index: 10000;

        }



        .modal-adm-content {

            background: var(--branco);

            padding: 30px;

            border-radius: 12px;

            border: 3px solid var(--ouro-fosco);

            text-align: center;

            width: 320px;

        }



        .modal-adm-content h3 {

            color: var(--azul-escuro);

            margin-bottom: 20px;

            font-size: 1.1rem;

        }



        .modal-adm-content input {

            letter-spacing: 3px;

            font-weight: bold;

            text-align: center;

            font-size: 1.2rem;

            margin-bottom: 20px;

        }



        .modal-adm-content .btn-confirm {

            background: var(--azul-escuro);

            color: var(--ouro-fosco);

            width: 100%;

            padding: 12px;

        }



        .modal-adm-content .btn-cancel {

            background: #ccc;

            color: #333;

            width: 100%;

            padding: 8px;

            margin-top: 10px;

            font-size: 0.7rem;

        }



        @media print {

            body { background: white; padding: 0; }

            .container { border: none; box-shadow: none; width: 100%; max-width: 100%; }

            .actions, #lock-screen, .file-input-wrapper, #admin-btn, #admin-screen { display: none !important; }

            header { background: white !important; color: black !important; border-bottom: 2px solid black; }

            h2 { color: black !important; border-bottom: 1px solid black; }

            .result { border-left: 4px solid black; background: white; }

            footer { background: white; border-top: 1px solid black; }

            .graficos-container { background: white; border-top: 1px solid black; }

            .footer-developer { display: none !important; }

            #broker-info-print { display: block !important; }

            .logo-container { background: white !important; color: black !important; border-bottom: 2px solid black !important; }

            .logo-container h1, .logo-container p { color: black !important; }

        }



        .file-input-wrapper {

            margin-top: 10px;

            padding: 10px;

            border: 2px dashed var(--ouro-fosco);

            border-radius: 8px;

            text-align: center;

        }



        .footer-developer {

            text-align: center;

            padding: 20px;

            background-color: #f0f0f0;

            color: var(--azul-escuro);

            font-size: 0.75rem;

            border-top: 2px solid var(--ouro-fosco);

            line-height: 1.5;

        }



        .footer-developer a {

            color: var(--azul-escuro);

            text-decoration: none;

            font-weight: bold;

        }



        .footer-developer a:hover {

            color: var(--ouro-fosco);

            text-decoration: underline;

        }



        /* ADMIN STYLES */

        #admin-btn {

            position: absolute;

            top: 10px;

            right: 10px;

            background: transparent;

            border: none;

            color: var(--ouro-fosco);

            cursor: pointer;

            z-index: 100;

            font-size: 1.5rem;

            padding: 5px;

        }



        #admin-screen {

            position: fixed;

            top: 0; left: 0; width: 100%; height: 100%;

            background: rgba(0, 31, 63, 0.95);

            color: white;

            z-index: 2000;

            display: flex;

            flex-direction: column;

            align-items: center;

            padding-top: 50px;

            overflow-y: auto;

        }



        .admin-content {

            width: 90%;

            max-width: 600px;

            background: white;

            color: var(--azul-escuro);

            padding: 30px;

            border-radius: 12px;

            box-shadow: 0 5px 15px rgba(0,0,0,0.3);

            margin-bottom: 50px;

        }



        .drop-zone {

            border: 2px dashed var(--ouro-fosco);

            padding: 20px;

            text-align: center;

            margin: 10px 0;

            cursor: pointer;

            border-radius: 8px;

            transition: background 0.3s;

        }



        .drop-zone:hover {

            background: #fcf8f0;

        }



        .gallery-preview {

            display: flex;

            gap: 10px;

            flex-wrap: wrap;

            margin-top: 10px;

            padding: 10px;

            background: #f4f4f4;

            border-radius: 8px;

            min-height: 50px;

        }



        .preview-img {

            width: 80px;

            height: 80px;

            object-fit: cover;

            border: 1px solid #ccc;

            border-radius: 4px;

        }



        .admin-scroll {

            max-height: 400px;

            overflow-y: auto;

            padding-right: 10px;

            margin-top: 20px;

            border-top: 1px solid #eee;

        }



        .admin-scroll::-webkit-scrollbar { width: 8px; }

        .admin-scroll::-webkit-scrollbar-track { background: #f1f1f1; }

        .admin-scroll::-webkit-scrollbar-thumb { background: var(--ouro-fosco); border-radius: 4px; }



        .admin-header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            width: 100%;

            margin-bottom: 20px;

        }



        .close-admin {

            background: #ff4d4d;

            color: white;

            padding: 5px 15px;

            border-radius: 4px;

        }

@media print {
    /* 1. Redução Global de Margens e Fontes */
    body {
        padding: 0 !important;
        margin: 0 !important;
        font-size: 10px !important; /* Diminui o texto geral */
    }

    .container {
        max-width: 100% !important;
        border: none !important;
        padding: 5px !important;
    }

    /* 2. Forçar Grid de 2 ou 3 colunas (Economia de Espaço Vertical) */
    .grid {
        display: grid !important;
        grid-template-columns: 1fr 1fr 1fr !important; /* Coloca 3 campos por linha */
        gap: 5px !important;
    }

    /* 3. Comprimir seções (Boxes) */
    .box {
        padding: 8px !important;
        margin-bottom: 5px !important;
        border-bottom: 1px solid #eee !important;
    }

    h2 {
        font-size: 12px !important;
        margin: 5px 0 !important;
        padding-bottom: 2px !important;
    }

    /* 4. Esconder Elementos que gastam papel e tinta */
    .actions, #admin-btn, #lock-screen, .footer-developer, .file-input-wrapper {
        display: none !important;
    }

    /* 5. Comprimir Resultados */
    .result {
        padding: 4px !important;
        font-size: 11px !important;
        min-height: auto !important;
    }

    /* 6. Ajustar Imagens para não ocuparem meia folha */
    #main-emp-img, #main-broker-img {
        max-height: 40px !important;
    }

    /* 7. Texto de Importante/Rodapé */
    footer {
        font-size: 8px !important;
        padding: 5px !important;
    }
}


    </style>

</head>

<body>


<!-- ESTRUTURA DE CAPTURA DE DADOS DA CAIXA-->

<!-- ÍCONE DE CONFIGURAÇÃO -->

<button id="admin-btn" onclick="openAdmin()" title="Configurações Administrativas">⚙️</button>



<div id="lock-screen">

    <div id="lock-logo-container" class="logo-container logo-demo" style="width: 100%; margin-bottom: 30px;">

        <h1>Simulador <span>Corretor de Elite 4.0</span></h1>

        <p id="lock-logo-tagline">VENDA SEGURA - DEMO</p>

    </div>

    <p id="lock-msg">Insira a senha para acessar o simulador</p>

    <input type="password" id="pass-input" placeholder="XXXXXX">

    <button onclick="checkPass()">Entrar</button>

    <div id="new-user-setup" class="hidden">

        <hr style="width: 80%; border-color: var(--ouro-fosco)">

        <p>Configurar nova senha de usuário (6 dígitos)</p>

        <input type="password" id="new-pass" maxlength="6" placeholder="Nova Senha">

        <button onclick="setNewPass()">Salvar Nova Senha</button>

    </div>

    <!-- Botão ADM-MASTER na tela de abertura -->

    <button id="btn-adm-master" onclick="openMasterModal()">ADM-MASTER</button>

</div>



<!-- TELA ADMIN -->

<div id="admin-screen" class="hidden">

    <div class="admin-content">

        <div class="admin-header">

            <h2 style="margin:0">Área Administrativa</h2>

            <button class="close-admin" onclick="closeAdmin()">Fechar</button>

        </div>

       

        <div id="admin-login-box">

            <p>Acesso Protegido</p>

            <input type="password" id="admin-pass" placeholder="Senha Admin">

            <button onclick="loginAdmin()" style="width:100%; margin-top:10px; background: var(--azul-escuro); color: white;">Acessar Painel</button>

        </div>



        <div id="admin-panel" class="hidden">

            <div class="admin-scroll">

                <h3>Dados do Corretor & Empreendimento</h3>

                <label>Nome do Empreendimento</label>

                <input type="text" id="admin-emp-name" oninput="syncAdminData()">

               

                <label>Nome do Corretor</label>

                <input type="text" id="admin-broker-name" oninput="syncAdminData()">

               

                <label>CRECI/SP</label>

                <input type="text" id="admin-creci" oninput="formatCRECI(this); syncAdminData()">

               

                <label>WhatsApp</label>

                <input type="text" id="admin-whatsapp" placeholder="(00) 00000-0000" oninput="syncAdminData()">



                <hr>



                <h3>Gestão de Imagens (Upload)</h3>

                <p>Arraste e solte as fotos abaixo:</p>

               

                <label>Foto do Empreendimento</label>

                <div class="drop-zone" id="drop-emp" ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'emp')">

                    Clique ou Arraste a Foto do Empreendimento

                </div>

                <div class="gallery-preview" id="preview-emp"></div>



                <label>Foto do Corretor</label>

                <div class="drop-zone" id="drop-broker" ondragover="handleDragOver(event)" ondrop="handleDrop(event, 'broker')">

                    Clique ou Arraste a Foto do Corretor

                </div>

                <div class="gallery-preview" id="preview-broker"></div>

               

                <div style="margin-top:20px; padding:10px; background:#e8f4fd; border-radius:4px; font-size:0.8rem;">

                    <strong>Nota:</strong> As imagens são salvas localmente nesta sessão, no seu servidor.

                </div>



                <div style="margin-top:30px; padding:20px; border: 2px solid #ff4d4d; border-radius:8px; text-align:center;">

                    <h4 style="color:#ff4d4d; margin-top:0;">APAGAR SISTEMA CADASTRAR NOVO USUÁRIO</h4>

                    <p style="font-size:0.8rem; color:#666;"><b>Use esta função apenas para cadastrar novos usuários do sistema (Corretores, Imobiliárias, Clientes ou Usuários Adm), uma nova senha MASTER deverá ser solicitada. 
                        Não cobramos mensalidades, somente acesso ao sistema: WhatsApp (11)94677-0625 - Email: lourencojunior.corretor@creci.org.br</b>

                    </p>

                    <button onclick="resetSystem()" style="background:#ff4d4d; color:white; width:100%;">RESETAR PARA NOVO USUÁRIO</button>

                </div>

            </div>

        </div>

    </div>

</div>



<div id="main-content" class="container hidden">

    <header id="main-header" class="logo-container logo-demo">

        <div id="header-images" style="display:flex; justify-content: space-between; align-items: center; padding: 0 20px;">

            <img id="main-emp-img" style="max-height: 60px; display: none;">

            <div style="flex-grow: 1; text-align: center;">

                <h1 id="main-logo-title">Simulador <span>Corretor de Elite 4.0</span></h1>

                <p id="main-logo-tagline">VENDA SEGURA - DEMO</p>

            </div>

            <img id="main-broker-img" style="max-height: 60px; border-radius: 50%; display: none;">

        </div>

        <p style="padding: 0 20px; font-style: italic; font-size: 0.9rem; margin-top: 15px;">"O diferencial do seu simulador não é apenas mostrar o valor da parcela, mas mostrar o cenário real para o cliente. No mercado imobiliário, o cliente não compra tijolo, ele compra segurança financeira"</p>

    </header>


<div id="drop-zone-logo" 
     style="width: 100%; max-width: 300px; margin: 0 auto 5px auto; padding: 5px; border: 1px dashed var(--ouro-fosco); border-radius: 4px; background: #fff; cursor: pointer; text-align: center;"
     ondragover="event.preventDefault();"
     ondrop="handleLogoDrop(event)">
    
    <img id="logo-preview" 
         src="https://i.ibb.co/LzNfXhS/logo-full-social.png" 
         style="max-height: 80px; width: auto; filter: drop-shadow(0px 1px 1px rgba(0,0,0,0.1));">
    
    <div style="font-size: 8px; color: #aaa; font-family: Arial; margin-top: 2px;">
        LOGO EMPREENDIMENTO
    </div>
</div>

<script>
    function handleLogoDrop(e) {
        e.preventDefault();
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (event) => {
                document.getElementById('logo-preview').src = event.target.result;
                localStorage.setItem('elite_logo_temp', event.target.result);
            };
            reader.readAsDataURL(file);
        }
    }
    window.addEventListener('load', () => {
        const savedLogo = localStorage.getItem('elite_logo_temp');
        if (savedLogo) document.getElementById('logo-preview').src = savedLogo;
    
    });
      
       
   const botaoBaixar = document.querySelector('#seu-botao-id');

botaoBaixar.addEventListener('click', () => {
    // Onde 'dataUrl' é o conteúdo do seu arquivo (Base64 ou Blob URL)
    const link = document.createElement('a');
    link.href = dataUrl; 
    link.download = 'simulacao.pdf';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
});
   
   // Exemplo genérico com uma biblioteca de PDF
geradorDePdf.fazerSimulacao().then((dataUrl) => {
    const link = document.createElement('a');
    link.href = dataUrl;
    link.download = 'simulacao.pdf';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
});
   
  
</script>



    <div class="box">

        <h2>Dados do Empreendimento</h2>

        <div class="grid">

            <input type="text" id="info-emp" placeholder="Empreendimento">

            <input type="text" id="info-cli" placeholder="Cliente">

            <input type="text" id="info-m2" placeholder="Unidade m²">

            <input type="text" id="info-andar" placeholder="Andar">

            <input type="text" id="info-apto" placeholder="Apto">

            <input type="text" id="info-cons" placeholder="Consultor">

            <input type="text" id="info-creci" placeholder="CRECI/SP (000.000-F)" style="grid-column: span 2" oninput="formatCRECI(this)">

            <input type="hidden" id="info-whatsapp">

        </div>

    </div>



    <div class="box" id="broker-info-print" style="display: none;">

        <h2>Dados do Corretor</h2>

        <div style="padding: 15px 0;">

            <p style="margin: 5px 0 15px 0; font-size: 0.9rem;"><strong>Nome:</strong> <span id="print-broker-name" style="font-weight: bold;"></span></p>

            <p style="margin: 0; font-size: 0.9rem;"><strong>WhatsApp:</strong> <span id="print-broker-contact" style="font-weight: bold;"></span></p>

        </div>

        <div style="display: grid; grid-template-columns: 1fr; gap: 10px; padding: 15px 0; border-top: 1px solid #ddd;">

            <p style="margin: 0; font-size: 0.9rem;"><strong>CRECI/SP:</strong> <span id="print-broker-creci" style="font-weight: bold;"></span></p>

        </div>

    </div>



    <div class="box">

        <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--ouro-fosco); margin-bottom: 15px;">

            <h2>Simulação Consultoria Técnica Aprovação</h2>

            <span id="data-simulacao" style="font-size: 0.8rem; color: var(--azul-escuro); font-weight: bold;"></span>

        </div>

       

        <div class="grid">

            <div>

                <label>Valor de Avaliação Imobiliária</label>

                <input id="avaliacao" type="text" oninput="formatCurrencyInput(this); calc()">

            </div>

            <div>

                <label>Valor de Lançamento</label>

                <input id="lancamento" type="text" oninput="formatCurrencyInput(this); calc()">

            </div>

        </div>

  

        <label>Desconto de Lançamento</label>

        <div class="result" id="descLanc">R$ 0,00</div>

       

        <label>Documentação + ITBI Grátis (4%)</label>

        <div class="result" id="documentos">R$ 0,00</div>

       

        <label>Desconto Campanha mês</label>

        <input id="campanha" type="text" oninput="formatCurrencyInput(this); calc()">

       

        <label>Total de Benefícios Construtora</label>

        <div class="result" id="beneficios" style="background: #e8f4fd;">R$ 0,00</div>

    </div>

<!--AQUI ESTA SEU SUA SIMULAÇÃO DO PORTAL CAIXA-->


<div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px;">
    
    <div style="display: flex; justify-content: flex-end; align-items: center; padding: 10px; background-color: #f8f9fa; border-radius: 8px; border: 1px dashed #005ca9;">
        <span style="font-size: 13px; color: #555; margin-right: 15px; font-weight: 500; font-family: Arial, sans-serif;">
           <em> "Aqui está o seu plano de obras conosco, e clicando neste botão, faremos uma simulação para validarmos agora mesmo sua margem no banco, 
            Aviso Legal: As condições apresentadas são simulações baseadas nas informações fornecidas e estão sujeitas à aprovação final e análise de crédito, nos termos da legislação vigente".</em>
            :</em>
        </span>
        <a href="https://www8.caixa.gov.br/siopiinternet-web/simulaOperacaoInternet.do?method=inicializarCasoUso" 
           target="_blank" 
           style="background-color: #005ca9; color: white; padding: 10px 18px; text-decoration: none; border-radius: 5px; font-weight: bold; font-family: Arial, sans-serif; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <svg width="18" height="18" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="40" height="40" rx="4" fill="white"/>
                <path d="M10 10L30 30M30 10L10 30" stroke="#005ca9" stroke-width="6"/>
                <path d="M25 8L32 15L22 25L15 18L25 8Z" fill="#f39200"/>
            </svg>
            <span style="font-size: 13px;">Simulador Caixa W8</span>
        </a>
    </div>


    <div class="box">

        <h2>Simulação Portal Caixa</h2>

        <div class="grid">

            <div>

                <label>Simulação Aprovação Caixa</label>

                <input id="aprovacao" type="text" oninput="formatCurrencyInput(this); calc()">

            </div>

            <div>

                <label>Saldo do FGTS</label>

                <input id="fgts" type="text" oninput="formatCurrencyInput(this); calc()">

            </div>

            <div>

                <label>Subsídio Gov. Federal</label>

                <input id="subsidio" type="text" oninput="formatCurrencyInput(this); calc()">

            </div>

            <div>

                <label>Casa Paulista</label>

                <input id="casa" type="text" oninput="formatCurrencyInput(this); calc()">

            </div>

        </div>

        <label>Total Aprovação</label>

        <div class="result" id="totalAprov">R$ 0,00</div>

    </div>



    <div class="box">

        <h2>Evolução de Obras (Aprox.)</h2>

        <div class="grid">

            <div>

                <label>Parcela futura Caixa</label>

                <input id="parcelaCaixa" type="text" oninput="formatCurrencyInput(this); calc()">

            </div>

            <div>

                <label>% Fase Obras</label>

                <select id="percObras" onchange="calc()">

                    <option value="0">0%</option>

                    <option value="10">10%</option>

                    <option value="20">20%</option>

                    <option value="30">30%</option>

                    <option value="40">40%</option>

                    <option value="50">50%</option>

                    <option value="60">60%</option>

                    <option value="70">70%</option>

                    <option value="80">80%</option>

                    <option value="90">90%</option>

                    <option value="100">100%</option>

                </select>

            </div>

        </div>

        <label>Valor Aprox. Fase Obras</label>

        <div class="result" id="futuroCaixa">R$ 0,00</div>
    </div>


    <div class="box" style="background: #fff9e6;">

        <h2>Entrada Total Construtora</h2>

        <div class="result" id="entrada" style="font-size: 1.5rem; margin-bottom: 15px;">R$ 0,00</div>

       

        <div class="grid">

            <div>

                <label>Ato</label>

                <input id="ato" type="text" oninput="formatCurrencyInput(this); calc()">

            </div>

            <div>

                <label>Total Intermediárias</label>

                <input id="intermediarias" type="text" oninput="formatCurrencyInput(this); calc()">

            </div>

            <div>

                <label>Parcelamento Interm.</label>

                <select id="parc-interm" onchange="calc()">

                    <option value="1">1x</option>

                    <option value="2">2x</option>

                    <option value="3">3x</option>

                    <option value="4">4x</option>

                    <option value="5">5x</option>

                    <option value="6">6x</option>

                </select>

            </div>

            <div>

                <label>Valor Interm. (cada)</label>

                <div class="result" id="valor-interm-parc">R$ 0,00</div>

            </div>

            <div style="grid-column: span 2">

                <label>Chaves</label>

                <input id="chaves" type="text" oninput="formatCurrencyInput(this); calc()">

            </div>

        </div>

       

        <label>Saldo Parcelas Obras</label>

        <div class="result" id="subtotal">R$ 0,00</div>

       

        <div class="grid">

            <div>

                <label>Plano de Obras (Meses)</label>

                <input id="parcelasObras" type="number" value="1" min="1" oninput="calc()">

            </div>

            <div>

                <label>Valor da Parcela</label>

                <div class="result" id="valorObras">R$ 0,00</div>

            </div>

        </div>

    </div>



    <div class="actions">

        <button class="btn-pdf" onclick="generatePDF()">Gerar PDF / Imprimir</button>

        <button class="btn-print" onclick="window.print()">Imprimir Simulação</button>

        <button class="btn-wa" onclick="sendWhatsApp('simulacao')">Enviar WhatsApp</button>

        <button class="btn-email" onclick="sendEmail()">Enviar por E-mail</button>

        <button class="btn-doc" onclick="sendWhatsApp('docs')">Solicitar Documentos via WhatsApp</button>

        <button class="btn-graficos" onclick="toggleGraficos()">Ver Gráficos de Investimento</button>

    </div>



    <div id="graficos-section" class="graficos-container hidden">

        <h2>Análise Visual do Investimento</h2>

        <div class="grafico-item">

            <h3>Composição do Valor do Imóvel</h3>

            <p>Distribuição entre Financiamento, FGTS, Subsídios e Entrada.</p>

            <div class="grafico-canvas"><canvas id="chartComposicao"></canvas></div>

        </div>

        <div class="grafico-item">

            <h3>Fluxo de Pagamento (Entrada)</h3>

            <p>Divisão do aporte inicial: Ato, Intermediárias e Parcelas de Obras.</p>

            <div class="grafico-canvas"><canvas id="chartFluxo"></canvas></div>

        </div>

        <div class="grafico-item">

            <h3>Economia e Benefícios</h3>

            <p>Comparativo entre Valor de Avaliação e Custo Final (Descontos + Subsídios).</p>

            <div class="grafico-canvas"><canvas id="chartBeneficios"></canvas></div>

        </div>

    </div>



    <div id="modal-adm-master" class="hidden">

        <div class="modal-adm-content">

            <h3>DIGITE SENHA MASTER</h3>

            <input type="text" id="master-pass-input" placeholder="xxx-xxx-xxx-xxx" maxlength="15" oninput="formatMasterPass(this)">

            <button class="btn-confirm" onclick="validateMasterPass()">VALIDAR ACESSO</button>

            <button class="btn-cancel" onclick="closeMasterModal()">CANCELAR</button>

        </div>

    </div>



    <div class="box">

        <h2>Protocolo de Documentos</h2>

        <p style="font-size: 0.85rem; color: #666;">Selecione os arquivos PDF para informar ao cliente via WhatsApp quais documentos estão sendo processados.</p>

        <div class="file-input-wrapper">

            <input type="file" id="pdf-upload" multiple accept=".pdf" onchange="updateFileList()" style="display: none;">

            <button onclick="document.getElementById('pdf-upload').click()" style="background: var(--ouro-fosco); color: var(--azul-escuro); width: auto; margin-bottom: 10px;">Selecionar Arquivos PDF</button>

            <div id="file-list" style="margin-top: 10px; font-size: 0.85rem;">

                <span style="color: #666; font-style: italic;">Nenhum arquivo selecionado</span>

            </div>

        </div>

        <button class="btn-wa" style="width: 100%; margin-top: 15px;" onclick="enviarAnexosWhatsapp()">Confirmar Recebimento via WhatsApp</button>

    </div>



    <footer>

        <strong>IMPORTANTE:</strong> <em></em><b>Esta simulação apresenta valores aproximados com base nas informações fornecidas. 
            Os valores reais de financiamento, subsídio e parcelas serão determinados pela Instituição Financeira após análise de crédito e avaliação do imóvel. 
            Taxas de juros e seguros podem variar conforme o perfil do cliente e regras do programa habitacional vigente.
            Os dados fornecidos nesta simulação são confidenciais e protegidos pela LGPD (Lei 13.709/2018), sendo utilizados exclusivamente para o cálculo de propostas".
            Ao clicar em simular, você autoriza o tratamento dos seus dados para esta finalidade, com total segurança técnica e administrativa
        </b>

    </footer>
</div>


<script>

    const SENHA_PROVISORIA = "ADMIN123";

    const SENHA_DEMO = "123456";

    const SENHA_MASTER = "072.801.868.310";



    function openMasterModal() {

        document.getElementById('modal-adm-master').classList.remove('hidden');

        document.getElementById('master-pass-input').focus();

    }



    function closeMasterModal() {

        document.getElementById('modal-adm-master').classList.add('hidden');

        document.getElementById('master-pass-input').value = '';

    }



    function formatMasterPass(input) {

        let v = input.value.replace(/\W/g, '').toUpperCase();

        let parts = [];

        for (let i = 0; i < v.length; i += 3) {

            parts.push(v.substring(i, i + 3));

        }

        input.value = parts.join('-');

    }



    function validateMasterPass() {

        const input = document.getElementById('master-pass-input').value;


        // A diretriz pede para validar contra a constante e permitir inserção externa

        if (input === SENHA_MASTER || input.replace(/-/g, '') === SENHA_MASTER.replace(/[^a-zA-Z0-9]/g, '')) {

            alert("ACESSO MASTER VALIDADO");

            // Lógica para permitir inserção externa/mudança para liberação futura

            const novaSenha = prompt("INSIRA A SENHA DE LIBERAÇÃO PARA ESTE NOVO ENVIO:");

            if (novaSenha) {

                localStorage.setItem('senhaUsuario', novaSenha);

                alert("SISTEMA CONFIGURADO PARA NOVO ENVIO COM A SENHA FORNECIDA.");

                closeMasterModal();

            }

        } else {

            alert("SENHA MASTER INCORRETA");

        }

    }

    const SENHA_REMOVER = "REMOVEFOTO";

    const SENHA_RESET = "ASSECOM03662";

   

    let senhaUsuario = localStorage.getItem('senhaUsuario');

    let dataCriacao = localStorage.getItem('dataCriacao');

    let diffDays = 0;

    let diasRestantes = 7;

    let isFullVersion = localStorage.getItem('isFullVersion') === 'true';

   

    if (!dataCriacao) {

        dataCriacao = new Date().toISOString();

        localStorage.setItem('dataCriacao', dataCriacao);

        diffDays = 0;

        diasRestantes = 7;

    } else {

        const dataAtual = new Date();

        const dataCriacaoObj = new Date(dataCriacao);

        const diffTime = Math.abs(dataAtual - dataCriacaoObj);

        diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        diasRestantes = Math.max(0, 7 - diffDays);

    }

   

    if (isNaN(diasRestantes)) diasRestantes = 7;



    let charts = { g1: null, g2: null, g3: null };



// LÓGICA DE TRANSFERENCIA CAIXA 


    // PROTEÇÃO DE LICENÇA POR DISPOSITIVO

    function checkDeviceLicense() {

        const deviceId = localStorage.getItem('device_id');

        const currentDeviceId = navigator.userAgent + navigator.language + screen.width + screen.height;

       

        if (!deviceId) {

            // Primeiro acesso neste dispositivo

            localStorage.setItem('device_id', currentDeviceId);

            // Se já havia dados mas o device_id é novo, reseta para DEMO

            if (localStorage.getItem('isFullVersion') === 'true') {

                localStorage.removeItem('isFullVersion');

                localStorage.removeItem('senhaUsuario');

                alert("Novo dispositivo detectado. Adquira nova licença.");

                location.reload();

            }

        } else if (deviceId !== currentDeviceId) {

            // Dispositivo diferente detectado

            localStorage.clear();

            localStorage.setItem('device_id', currentDeviceId);

            alert("Dispositivo não autorizado. Adquira nova licença.");

            location.reload();

        }

    }



    window.onload = function() {

        checkDeviceLicense();

        gerarDataValidade();

        const lockScreen = document.getElementById('lock-screen');

        const lockMsg = document.getElementById('lock-msg');



        if (diffDays >= 8 && !isFullVersion) {

            localStorage.clear();

            lockScreen.innerHTML = `

                <h1 style="color: #ff4d4d">SISTEMA BLOQUEADO</h1>

                <p>O prazo de 7 dias expirou e o sistema foi resetado.</p>

                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; border: 1px solid #C5A059; margin: 20px;">

                    <p>Para liberação e fornecimento de nova senha definitiva:</p>

                    <p><strong>Chave PIX: 03662114000195</strong></p>

                    <p>Valor de desenvolvimento: R$ 59,90 - Oferta válida de 01/02/2026 a 31/03/2026</p>

                    <p>Valor de desenvolvimento: R$ 79,90 - Oferta válida até 01/04/2026 a 31/07/2026</p>

                    <p>Valor de desenvolvimento: R$ 129,90 - A partir de 01/08/2026</p>

                    <p style="font-size: 0.7rem;">ASSECOM ASSESSORIA DE COB MERCANTIS SC LTDA</p>

                </div>

                <button onclick="location.reload()">Atualizar</button>

            `;

        } else {

            if (isFullVersion) {

                applyFullVersionLogo();

                lockMsg.innerHTML = `<span style="color: var(--ouro-fosco)">SISTEMA LIBERADO - ACESSO TOTAL</span>`;

            } else {

                lockMsg.innerHTML = `<span style="color: #fff">Acesso Provisório: <strong>Restam ${diasRestantes} dias</strong></span>`;

            }

        }

       

        loadAdminData();

    };



    function applyFullVersionLogo() {

        const lockLogo = document.getElementById('lock-logo-container');

        const mainHeader = document.getElementById('main-header');

        const lockTagline = document.getElementById('lock-logo-tagline');

        const mainTagline = document.getElementById('main-logo-tagline');



        // Trocar classes para versão FULL

        lockLogo.classList.remove('logo-demo');

        lockLogo.classList.add('logo-full');

        mainHeader.classList.remove('logo-demo');

        mainHeader.classList.add('logo-full');



        // Atualizar textos

        lockTagline.innerText = "VENDA SEGURA";

        mainTagline.innerText = "VENDA SEGURA";

       

        // Remover o span de cor dourada na versão full para manter o ouro fosco uniforme

        document.getElementById('main-logo-title').innerHTML = "Simulador Corretor de Elite 4.0";

        document.querySelector('#lock-logo-container h1').innerHTML = "Simulador Corretor de Elite 4.0";

    }



    function checkPass() {

        if (diffDays >= 8 && !isFullVersion) {

            localStorage.clear();

            location.reload();

            return;

        }

        const input = document.getElementById('pass-input').value;

        if (input === SENHA_MASTER) {

            isFullVersion = true;

            localStorage.setItem('isFullVersion', 'true');

            applyFullVersionLogo();

            document.getElementById('new-user-setup').classList.remove('hidden');

            alert("Senha Master confirmada. Acesso total liberado!");

            return;

        }

        if (senhaUsuario && input === senhaUsuario) {

            unlock();

            return;

        }

        if (input === SENHA_PROVISORIA || input === SENHA_DEMO) {

            unlock();

        } else {

            alert("Senha incorreta!");

        }

    }

  

    function unlock() {

        document.getElementById('lock-screen').classList.add('hidden');

        document.getElementById('main-content').classList.remove('hidden');

    }



    // ADMIN FUNCTIONS

    function openAdmin() {

        document.getElementById('admin-screen').classList.remove('hidden');

    }



    function closeAdmin() {

        document.getElementById('admin-screen').classList.add('hidden');

    }



    function loginAdmin() {

        const pass = document.getElementById('admin-pass').value;

        if (pass === SENHA_PROVISORIA || pass === SENHA_DEMO || pass === SENHA_MASTER) {

            document.getElementById('admin-login-box').classList.add('hidden');

            document.getElementById('admin-panel').classList.remove('hidden');

        } else {

            alert("Senha administrativa incorreta!");

        }

    }



    function syncAdminData() {

        const emp = document.getElementById('admin-emp-name').value;

        const broker = document.getElementById('admin-broker-name').value;

        const creci = document.getElementById('admin-creci').value;

        const whatsapp = document.getElementById('admin-whatsapp').value;



        document.getElementById('info-emp').value = emp;

        document.getElementById('info-cons').value = broker;

        document.getElementById('info-creci').value = creci;

        document.getElementById('info-whatsapp').value = whatsapp;



        document.getElementById('print-broker-name').innerText = broker;

        document.getElementById('print-broker-creci').innerText = creci;

        document.getElementById('print-broker-contact').innerText = whatsapp;



        localStorage.setItem('admin_emp', emp);

        localStorage.setItem('admin_broker', broker);

        localStorage.setItem('admin_creci', creci);

        localStorage.setItem('admin_whatsapp', whatsapp);

    }



    function loadAdminData() {

        const emp = localStorage.getItem('admin_emp') || "";

        const broker = localStorage.getItem('admin_broker') || "";

        const creci = localStorage.getItem('admin_creci') || "";

        const whatsapp = localStorage.getItem('admin_whatsapp') || "";

        const imgEmp = localStorage.getItem('admin_img_emp');

        const imgBroker = localStorage.getItem('admin_img_broker');



        document.getElementById('admin-emp-name').value = emp;

        document.getElementById('admin-broker-name').value = broker;

        document.getElementById('admin-creci').value = creci;

        document.getElementById('admin-whatsapp').value = whatsapp;



        if (imgEmp) {

            displayImage('emp', imgEmp);

            document.getElementById('main-emp-img').src = imgEmp;

            document.getElementById('main-emp-img').style.display = 'block';

        }

        if (imgBroker) {

            displayImage('broker', imgBroker);

            document.getElementById('main-broker-img').src = imgBroker;

            document.getElementById('main-broker-img').style.display = 'block';

        }



        syncAdminData();

    }



    function handleDragOver(e) {

        e.preventDefault();

        e.stopPropagation();

    }



    function handleDrop(e, type) {

        e.preventDefault();

        e.stopPropagation();

        const files = e.dataTransfer.files;

        if (files.length > 0) {

            const file = files[0];

            if (file.type.startsWith('image/')) {

                const reader = new FileReader();

                reader.onload = function(event) {

                    const base64 = event.target.result;

                    localStorage.setItem('admin_img_' + type, base64);

                    displayImage(type, base64);

                   

                    if (type === 'emp') {

                        document.getElementById('main-emp-img').src = base64;

                        document.getElementById('main-emp-img').style.display = 'block';

                    } else {

                        document.getElementById('main-broker-img').src = base64;

                        document.getElementById('main-broker-img').style.display = 'block';

                    }

                };

                reader.readAsDataURL(file);

            }

        }

    }



    function displayImage(type, src) {

        const container = document.getElementById('preview-' + type);

        container.innerHTML = `

            <div style="position: relative; display: inline-block;">

                <img src="${src}" class="preview-img">

                <button onclick="removePhoto('${type}')" style="position: absolute; top: -5px; right: -5px; background: #ff4d4d; color: white; border-radius: 50%; width: 20px; height: 20px; padding: 0; font-size: 12px; line-height: 20px; border: 1px solid white;">×</button>

            </div>

        `;

    }



    function removePhoto(type) {

        const pass = prompt("Digite a senha para remover a foto:");

        if (pass === SENHA_REMOVER) {

            localStorage.removeItem('admin_img_' + type);

            document.getElementById('preview-' + type).innerHTML = '';

            const mainImg = type === 'emp' ? 'main-emp-img' : 'main-broker-img';

            document.getElementById(mainImg).src = '';

            document.getElementById(mainImg).style.display = 'none';

            alert("Foto removida com sucesso!");

        } else if (pass !== null) {

            alert("Senha incorreta!");

        }

    }



    function resetSystem() {

        const pass = prompt("ATENÇÃO: Isso apagará TODOS os dados para um novo usuário.\nDigite a SENHA DE RESET para confirmar:");

        if (pass === SENHA_RESET) {

            if (confirm("Tem certeza absoluta? Todos os dados salvos, fotos e senhas de usuário serão deletados.")) {

                localStorage.clear();

                alert("Sistema resetado com sucesso! A página será recarregada. E uma nova senha MASTER deverá ser solicitada.");

                location.reload();

            }

        } else if (pass !== null) {

            alert("Senha de reset incorreta!");

        }

    }



    function enviarAnexosWhatsapp() {

        const cliente = document.getElementById('info-cli').value || "Cliente";

        const inputArquivos = document.getElementById('pdf-upload');

        let listaNomes = "";

        if (inputArquivos.files.length > 0) {

            for (let i = 0; i < inputArquivos.files.length; i++) {

                listaNomes += `\n✅ _${inputArquivos.files[i].name}_`;

            }

        } else {

            alert("Por favor, selecione ao menos um arquivo primeiro.");

            return;

        }

        const mensagem = `*PROTOCOLO DE DOCUMENTAÇÃO*\n\nOlá ${cliente}, estou processando os seguintes documentos para sua aprovação Caixa:${listaNomes}\n\n*Instrução:* Por favor, anexe estes arquivos abaixo para validação técnica.`;

        window.open(`https://wa.me/?text=${encodeURIComponent(mensagem)}`, '_blank');

    }



    function setNewPass() {

        const newPass = document.getElementById('new-pass').value;

        if (newPass.length === 6) {

            localStorage.setItem('senhaUsuario', newPass);

            senhaUsuario = newPass;

            alert("Nova senha de 6 dígitos configurada com sucesso!");

            unlock();

        } else {

            alert("A senha deve ter exatamente 6 dígitos.");

        }

    }



    function gerarDataValidade() {

        const hoje = new Date();

        const validade = new Date();

        validade.setDate(hoje.getDate() + 5);

        const opcoes = { day: '2-digit', month: '2-digit', year: 'numeric' };

        const dataHoje = hoje.toLocaleDateString('pt-BR', opcoes);

        const dataValidade = validade.toLocaleDateString('pt-BR', opcoes);

        const elem = document.getElementById('data-simulacao');

        if(elem) elem.innerText = `DATA: ${dataHoje} | VALIDADE: ${dataValidade}`;

    }



    function formatCRECI(input) {

        let value = input.value.replace(/\D/g, '');

        if (value.length > 6) value = value.slice(0, 6);

        let formatted = value;

        if (value.length > 3) { formatted = value.slice(0, 3) + '.' + value.slice(3); }

        if (value.length > 0) { input.value = formatted + '-F'; } else { input.value = ''; }

        const pos = input.value.indexOf('-F');

        if (pos !== -1) { setTimeout(() => input.setSelectionRange(pos, pos), 0); }

    }



    function formatCurrency(value) {

        return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);

    }



    function parseCurrency(value) {

        if (!value) return 0;

        return parseFloat(value.replace(/[^\d,]/g, '').replace(',', '.')) || 0;

    }



    function formatCurrencyInput(input) {

        let value = input.value.replace(/\D/g, '');

        value = (value / 100).toFixed(2) + '';

        value = value.replace(".", ",");

        value = value.replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");

        input.value = "R$ " + value;

    }



    function calc() {

        const avaliacao = parseCurrency(document.getElementById("avaliacao").value);

        const lanc = parseCurrency(document.getElementById("lancamento").value);

        const camp = parseCurrency(document.getElementById("campanha").value);

       

        const descontoLanc = Math.max(0, avaliacao - lanc);

        document.getElementById("descLanc").innerText = formatCurrency(descontoLanc);

       

        const docs = lanc * 0.04;

        document.getElementById("documentos").innerText = formatCurrency(docs);

       

        const beneficiosTotal = descontoLanc + docs + camp;

        document.getElementById("beneficios").innerText = formatCurrency(beneficiosTotal);

       

        const aprov = parseCurrency(document.getElementById("aprovacao").value);

        const fgts = parseCurrency(document.getElementById("fgts").value);

        const subs = parseCurrency(document.getElementById("subsidio").value);

        const casa = parseCurrency(document.getElementById("casa").value);

       

        const totalAprovacao = aprov + fgts + subs + casa;

        document.getElementById("totalAprov").innerText = formatCurrency(totalAprovacao);

       

        const percObras = parseFloat(document.getElementById("percObras").value) || 0;

        const parcelaFutura = parseCurrency(document.getElementById("parcelaCaixa").value);

        const futuro = parcelaFutura * (percObras / 100);

        document.getElementById("futuroCaixa").innerText = formatCurrency(futuro);

       

        const entradaConstrutora = Math.max(0, lanc - totalAprovacao - camp);

        document.getElementById("entrada").innerText = formatCurrency(entradaConstrutora);

       

        const atoV = parseCurrency(document.getElementById("ato").value);

        const interm = parseCurrency(document.getElementById("intermediarias").value);

        const chv = parseCurrency(document.getElementById("chaves").value);

       

        const numParcInterm = parseInt(document.getElementById("parc-interm").value);

        const valorParcInterm = interm / numParcInterm;

        document.getElementById("valor-interm-parc").innerText = formatCurrency(valorParcInterm);

       

        const sub = entradaConstrutora - atoV - interm - chv;

        document.getElementById("subtotal").innerText = formatCurrency(sub);

       

        const parcelas = parseInt(document.getElementById("parcelasObras").value) || 1;

        const valorParcela = sub / parcelas;

        document.getElementById("valorObras").innerText = formatCurrency(valorParcela);



        if (!document.getElementById('graficos-section').classList.contains('hidden')) {

            renderGraficos();

        }

    }



    /**

     * FileHandler - Processamento Assíncrono de Arquivos

     * Integração para garantir segurança do link e download/leitura em dispositivos móveis e computadores.

     * Simulação da estrutura Java via JavaScript assíncrono para ambiente Web/Android WebView.

     */

    const FileHandler = {

        processFileAsync: async function(file) {

            return new Promise((resolve, reject) => {

                // Simulação do ExecutorService para processamento em Thread separada

                setTimeout(() => {

                    try {

                        console.log("Processando arquivo via FileHandler:", file.name);

                        // Lógica de segurança e preparação do link

                        const reader = new FileReader();

                        reader.onload = (e) => {

                            resolve({

                                name: file.name,

                                size: file.size,

                                type: file.type,

                                data: e.target.result,

                                timestamp: new Date().getTime()

                            });

                        };

                        reader.onerror = reject;

                        reader.readAsDataURL(file);

                    } catch (err) {

                        reject(err);

                    }

                }, 100); // Delay simulando processamento assíncrono

            });

        }

    };



    async function updateFileList() {

        const input = document.getElementById('pdf-upload');

        const list = document.getElementById('file-list');

       

        if (input.files.length > 0) {

            list.innerHTML = "<em>Processando arquivos de forma segura...</em>";

           

            const processedFiles = [];

            for (let i = 0; i < input.files.length; i++) {

                try {

                    // Utilizando obrigatoriamente a estrutura de processamento assíncrono

                    const processed = await FileHandler.processFileAsync(input.files[i]);

                    processedFiles.push(processed);

                } catch (error) {

                    console.error("Erro no processamento do arquivo:", error);

                }

            }



            list.innerHTML = "";

            processedFiles.forEach(file => {

                list.innerHTML += `<div>✅ ${file.name} <small style="color: #888;">(Processado via FileHandler)</small></div>`;

            });

        } else {

            list.innerHTML = `<span style="color: #666; font-style: italic;">Nenhum arquivo selecionado</span>`;

        }

    }



    function generatePDF() { window.print(); }



    function sendWhatsApp(tipo) {

        const cliente = document.getElementById('info-cli').value || "Cliente";

        const brokerWhatsapp = document.getElementById('info-whatsapp').value;

        let text = "";

        if (tipo === 'simulacao') {

            text = `Olá ${cliente}, segue sua simulação do Corretor Elite:\n\n` +

                   `Valor de Avaliação Imobiliária: ${document.getElementById('avaliacao').value}\n` +      

                   `Valor Lançamento: ${document.getElementById('lancamento').value}\n` +

                   `Valor Desconto de Lançamento: ${document.getElementById('descLanc').innerText}\n` +

                   `Documentação + ITBI Grátis: ${document.getElementById('documentos').innerText}\n` +

                   `Desconto Campanha mês: ${document.getElementById('campanha').value}\n` +

                   `Total Benefícios Construtora: ${document.getElementById('beneficios').innerText}\n\n` +

                   `Simulação Aprovação Caixa: ${document.getElementById('aprovacao').value}\n` +

                   `Saldo do FGTS: ${document.getElementById('fgts').value}\n` +

                   `Subsídio Gov. Federal: ${document.getElementById('subsidio').value}\n` +

                   `Casa Paulista: ${document.getElementById('casa').value}\n` +

                   `Total Aprovação: ${document.getElementById('totalAprov').innerText}\n\n` +

                   `Parcela futura Caixa: ${document.getElementById('parcelaCaixa').value}\n` +

                   `% Fase Obras: ${document.getElementById('percObras').value}%\n` +

                   `Valor Aprox. Fase Obras: ${document.getElementById('futuroCaixa').innerText}\n\n` +

                   `Entrada Total Construtora: ${document.getElementById('entrada').innerText}\n` +

                   `Ato: ${document.getElementById('ato').value}\n` +

                   `Total Intermediárias: ${document.getElementById('intermediarias').value}\n` +

                   `Parcelamento Interm: ${document.getElementById('parc-interm').value}x de ${document.getElementById('valor-interm-parc').innerText}\n` +

                   `Chaves: ${document.getElementById('chaves').value}\n` +

                   `Saldo Parcelas Obras: ${document.getElementById('subtotal').innerText}\n` +

                   `Plano de Obras: ${document.getElementById('parcelasObras').value}x de ${document.getElementById('valorObras').innerText}\n\n` +

                   `*_Sujeito a análise de crédito e aprovação bancária._*`;

        } else {

            text = `Olá ${cliente}, por favor, envie seus documentos em PDF (RG/CNH, CERTIDÃO DE NASCIMENTO/CASAMENTO, CPF, C.T.P.S, 3 Últimos Comprovante de Renda, Extrato do FGTS, Comprovante de Residência, Declaração do Imposto de Renda + Recibo de Entrega do IR). Sendo Casado ou compor renda enviar os mesmos documentos solicitados. Renda Informal, sem registro, os últimos 6 meses de movimentação bancária, com limite de cheque especial ou 3 faturas do Cartão de crédito completas, Declaração de Renda constando profissão, data inicial da atividade e renda mensal para darmos continuidade à sua aprovação na Caixa.`;

        }

       

        const phone = brokerWhatsapp ? brokerWhatsapp.replace(/\D/g, '') : "";

        window.open(`https://wa.me/${phone}?text=${encodeURIComponent(text)}`, '_blank');

    }



    function sendEmail() {

        const cliente = document.getElementById('info-cli').value || "Cliente";

        window.location.href = `mailto:?subject=Simulação - ${cliente}&body=Segue os detalhes...`;

    }



    function toggleGraficos() {

        const section = document.getElementById('graficos-section');

        section.classList.toggle('hidden');

        if (!section.classList.contains('hidden')) {

            setTimeout(() => renderGraficos(), 100);

        }

    }



    function renderGraficos() {

        const ctx1 = document.getElementById('chartComposicao').getContext('2d');

        const ctx2 = document.getElementById('chartFluxo').getContext('2d');

        const ctx3 = document.getElementById('chartBeneficios').getContext('2d');



        const aprov = parseCurrency(document.getElementById("aprovacao").value);

        const fgts = parseCurrency(document.getElementById("fgts").value);

        const subs = parseCurrency(document.getElementById("subsidio").value) + parseCurrency(document.getElementById("casa").value);

        const entrada = parseCurrency(document.getElementById("entrada").innerText);



        if (charts.g1) charts.g1.destroy();

        charts.g1 = new Chart(ctx1, {

            type: 'doughnut',

            data: {

                labels: ['Financiamento', 'FGTS', 'Subsídios', 'Entrada'],

                datasets: [{

                    data: [aprov, fgts, subs, entrada],

                    backgroundColor: ['#001F3F', '#C5A059', '#34B7F1', '#EA4335'],

                    borderColor: '#FFFFFF',

                    borderWidth: 2

                }]

            },

            options: {

                responsive: true,

                maintainAspectRatio: false,

                plugins: {

                    legend: { position: 'bottom', labels: { font: { size: 11 }, color: '#001F3F', padding: 10 } }

                }

            }

        });



        const ato = parseCurrency(document.getElementById("ato").value);

        const interm = parseCurrency(document.getElementById("intermediarias").value);

        const obras = parseCurrency(document.getElementById("subtotal").innerText);

        const chaves = parseCurrency(document.getElementById("chaves").value);



        if (charts.g2) charts.g2.destroy();

        charts.g2 = new Chart(ctx2, {

            type: 'pie',

            data: {

                labels: ['Ato', 'Intermediárias', 'Obras', 'Chaves'],

                datasets: [{

                    data: [ato, interm, obras, chaves],

                    backgroundColor: ['#25D366', '#34B7F1', '#9C27B0', '#001F3F'],

                    borderColor: '#FFFFFF',

                    borderWidth: 2

                }]

            },

            options: {

                responsive: true,

                maintainAspectRatio: false,

                plugins: {

                    legend: { position: 'bottom', labels: { font: { size: 11 }, color: '#001F3F', padding: 10 } }

                }

            }

        });



        const avaliacao = parseCurrency(document.getElementById("avaliacao").value);

        const custoFinal = parseCurrency(document.getElementById("lancamento").value) - subs;

        const beneficios = avaliacao - custoFinal;



        if (charts.g3) charts.g3.destroy();

        charts.g3 = new Chart(ctx3, {

            type: 'bar',

            data: {

                labels: ['Mercado', 'Custo', 'Vantagem'],

                datasets: [{

                    label: 'R$',

                    data: [avaliacao, custoFinal, beneficios],

                    backgroundColor: ['#001F3F', '#C5A059', '#34B7F1'],

                    borderColor: '#FFFFFF',

                    borderWidth: 2

                }]

            },

            options: {

                responsive: true,

                maintainAspectRatio: false,

                plugins: {

                    legend: { position: 'bottom', labels: { font: { size: 11 }, color: '#001F3F', padding: 10 } }

                }

            }

        });


(function() {
    // Gerar uma "assinatura" do hardware do usuário
    const fingerprint = navigator.userAgent + navigator.language + screen.width;
    const storageKey = 'elite_license_auth';
    const masterKey = '282.767.428.900'; // Sua Senha Master

    function verificarAcesso() {
        const auth = localStorage.getItem(storageKey);
        
        // Se não houver autorização ou for de outro dispositivo, bloqueia
        if (!auth || auth !== btoa(fingerprint + masterKey)) {
            document.body.innerHTML = `
                <div style="height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#001F3F; color:#C5A059; font-family:Arial;">
                    <h1>LICENÇA NÃO AUTORIZADA</h1>
                    <p>Este software é protegido. Insira a Chave Master para este dispositivo.</p>
                    <input type="password" id="input_master" style="padding:10px; text-align:center;">
                    <button onclick="validarLicenca()" style="margin-top:10px; padding:10px 20px; background:#C5A059; border:none; cursor:pointer;">ATIVAR AGORA</button>
                </div>
            `;
            return false;
        }
        return true;
    
    // Impede o botão direito
document.addEventListener('contextmenu', event => event.preventDefault());

// Impede F12, Ctrl+Shift+I (Inspecionar) e Ctrl+U (Ver Código Fonte)
document.onkeydown = function(e) {
    if (e.keyCode == 123 || 
       (e.ctrlKey && e.shiftKey && e.keyCode == 73) || 
       (e.ctrlKey && e.keyCode == 85)) {
        return false;
    }
};
  
     
    }

    window.validarLicenca = function() {
        const input = document.getElementById('input_master').value;
        if (input === masterKey) {
            // Salva a licença criptografada vinculada a este dispositivo específico
            localStorage.setItem(storageKey, btoa(fingerprint + masterKey));
            alert("Licença ativada com sucesso!");
            location.reload();
        } else {
            alert("Chave Inválida!");
        }
    };

    // Executa a verificação ao carregar
    window.onload = verificarAcesso;
})();





    }

</script>

<div class="footer-developer">

    <p>©Todos os direitos reservados - Desenvolvedor: <strong>LOURENCO JUNIOR | Apoio: RODRIGO DIAS</strong></p>
    <p>Livro: <em>Planejamento Estratégico Corretores e Gestores Imobiliários - Método: Venda Segura</em></p>

    <p>

        WhatsApp: <a href="https://wa.me/5511946770625" target="_blank">(11) 94677-0625</a> |
        Email: <a href="mailto:lourencojunior.corretor@creci.org.br">lourencojunior.corretor@creci.org.br</a>

    </p>

</div>



</body>

</html>